<img src="https://oasislmf.org/packages/oasis_theme_package/themes/oasis_theme/assets/src/oasis-lmf-colour.png" alt="Oasis LMF logo" width="250"/>

[![Binder](https://mybinder.org/badge.svg)](https://mybinder.org/v2/gh/OasisLMF/OasisPiWind/master)
[![PiWind Testing](https://github.com/OasisLMF/OasisPiWind/actions/workflows/test.yml/badge.svg?branch=master)](https://github.com/OasisLMF/OasisPiWind/actions/workflows/test.yml)
[![PiWind MDK](https://github.com/OasisLMF/OasisPiWind/actions/workflows/run_mdk.yml/badge.svg?branch=master)](https://github.com/OasisLMF/OasisPiWind/actions/workflows/run_mdk.yml)

# Oasis PiWind
Toy UK windstorm model.

## Cloning the repository

You can clone this repository from <a href="https://github.com/OasisLMF/OasisPiWind" target="_blank">GitHub</a>.

## Running via the Oasis MDK

The <a href="https://pypi.org/project/oasislmf/" target="_blank">Oasis model development kit (MDK)</a> is a Python package which provides a command line interface (CLI) for developing and running models using the Oasis framework. It can be installed via the Python package installer `pip` (or `pip3` for Python 3). The PiWind repository contains a <a href="https://github.com/OasisLMF/OasisPiWind/blob/master/oasislmf.json" target="_blank">JSON configuration file</a> that allows the PiWind model to be run via the MDK.

Using the configuration file an end-to-end analysis can be executed using the command:

	oasislmf model run -C oasislmf.json

Files will be generated by default in a UTC timestamped folder named `runs/ProgOasis-<UTC timestamp`> in your working directory.

## Weighted vulnerability model feature

This version of PiWind has 4 extra vulnerability functions, with ids 13-16 representing an unknown occupancy type for the 4 combinations of peril and coverage.

| vulnerability_id | peril    | coverage_type   | occupancy code   |
|:-----------------|----------|-----------------| ----------------:|
|       13         | WTC      |    1            | 1000             |
|       14         | WTC      |    3            | 1000             |
|       15         | WSS      |    1            | 1000             |
|       16         | WSS      |    3            | 1000             |


These are listed in the vulnerability dictionary.

When a location has OccupancyCode = 1000 (unknown), instead of it being matched with a residential vulnerability function, it is matched with a mixture of residential and commercial vulnerability functions depending on which grid cell it lies in.

Some grid cells have a 80:20 weighting towards a residential vulnerability id, representing a mostly residential area, and other grid cells have a 75:25 weighting towards commercial representing a commercial district or town centre (although this is not the real mixture for the area, it has been made up for illustration purposes).

The weightings are represented in the model data as two extra files;

1) **aggregate_vulnerability** which contains the mapping from aggregate vulnerability ids 13-16 to detailed vulnerability ids 1-12 
2) **weights** which contain the weights of detailed vulnerability ids within each grid cell (areaperil_id). The numbers are integers representing a count from which a relative weight can be derived.

There is no need to pre-generate vulnerability functions 13-16 because the weightings are applied on-the-fly during the analysis. Therefore the vulnerability file does not change.

In order to make use of this feature, the full Monte Carlo sampling approach (calculation component 'gulmc') must be used. This can be specified in the oasislmf.json file as follows;

```
    "modelpy": true,
    "gulmc": true,
    "gulpy": false
```